{
  "path": "/docs/react/your-first-app/4-loading-photos",
  "previousText": "Saving Photos on Filesystem",
  "previousUrl": "/docs/react/your-first-app/3-saving-photos",
  "nextText": "Adding Mobile",
  "nextUrl": "/docs/react/your-first-app/5-adding-mobile",
  "body": [
    "div",
    null,
    [
      "p",
      {
        "class": "intro"
      },
      "We’ve implemented photo taking and saving to the filesystem. There’s one last piece of functionality missing: the photos are stored in the filesystem, but we need a way to save pointers to each file so that they can be displayed again in the photo gallery."
    ],
    " ",
    [
      "p",
      {
        "class": "intro"
      },
      "Fortunately, this is easy: we’ll leverage the Capacitor ",
      [
        "a",
        {
          "href": "https://capacitor.ionicframework.com/docs/apis/storage"
        },
        "Storage API"
      ],
      " to store our array of Photos in a key-value store. "
    ],
    " ",
    [
      "h2",
      {
        "id": "storage-api"
      },
      " ",
      [
        "a",
        {
          "href": "#storage-api"
        },
        "Storage API"
      ],
      " "
    ],
    " ",
    [
      "p",
      null,
      "Begin by defining a constant variable that will act as the key for the store before the ",
      [
        "code",
        null,
        "usePhotoGallery"
      ],
      " function definition in ",
      [
        "code",
        null,
        "src/hooks/usePhotoGallery.ts"
      ],
      ":"
    ],
    " ",
    [
      "docs-code",
      {
        "language": "typescript"
      },
      " ",
      [
        "pre",
        null,
        [
          "code",
          null,
          [
            "span",
            {
              "class": "token keyword"
            },
            "const"
          ],
          " ",
          [
            "span",
            {
              "class": "token constant"
            },
            "PHOTO_STORAGE"
          ],
          " ",
          [
            "span",
            {
              "class": "token operator"
            },
            "="
          ],
          " ",
          [
            "span",
            {
              "class": "token string"
            },
            "\"photos\""
          ],
          [
            "span",
            {
              "class": "token punctuation"
            },
            ";"
          ],
          "\n",
          [
            "span",
            {
              "class": "token keyword"
            },
            "export"
          ],
          " ",
          [
            "span",
            {
              "class": "token keyword"
            },
            "function"
          ],
          " ",
          [
            "span",
            {
              "class": "token function"
            },
            "usePhotoGallery"
          ],
          [
            "span",
            {
              "class": "token punctuation"
            },
            "("
          ],
          [
            "span",
            {
              "class": "token punctuation"
            },
            ")"
          ],
          " ",
          [
            "span",
            {
              "class": "token punctuation"
            },
            "{"
          ],
          [
            "span",
            {
              "class": "token punctuation"
            },
            "}"
          ]
        ]
      ],
      " "
    ],
    " ",
    [
      "p",
      null,
      "Then, use the ",
      [
        "code",
        null,
        "useStorage"
      ],
      " hook to get access to handy get and set methods for reading and writing to device storage:"
    ],
    " ",
    [
      "docs-code",
      {
        "language": "typescript"
      },
      " ",
      [
        "pre",
        null,
        [
          "code",
          null,
          [
            "span",
            {
              "class": "token keyword"
            },
            "const"
          ],
          " ",
          [
            "span",
            {
              "class": "token punctuation"
            },
            "{"
          ],
          " ",
          [
            "span",
            {
              "class": "token keyword"
            },
            "get"
          ],
          [
            "span",
            {
              "class": "token punctuation"
            },
            ","
          ],
          " ",
          [
            "span",
            {
              "class": "token keyword"
            },
            "set"
          ],
          " ",
          [
            "span",
            {
              "class": "token punctuation"
            },
            "}"
          ],
          " ",
          [
            "span",
            {
              "class": "token operator"
            },
            "="
          ],
          " ",
          [
            "span",
            {
              "class": "token function"
            },
            "useStorage"
          ],
          [
            "span",
            {
              "class": "token punctuation"
            },
            "("
          ],
          [
            "span",
            {
              "class": "token punctuation"
            },
            ")"
          ],
          [
            "span",
            {
              "class": "token punctuation"
            },
            ";"
          ]
        ]
      ],
      " "
    ],
    " ",
    [
      "p",
      null,
      "Next, at the end of the ",
      [
        "code",
        null,
        "takePhoto"
      ],
      " function, add a call to ",
      [
        "code",
        null,
        "set()"
      ],
      " to save the Photos array. By adding it here, the Photos array is stored each time a new photo is taken. This way, it doesn’t matter when the app user closes or switches to a different app - all photo data is saved."
    ],
    " ",
    [
      "docs-code",
      {
        "language": "typescript"
      },
      " ",
      [
        "pre",
        null,
        [
          "code",
          null,
          [
            "span",
            {
              "class": "token keyword"
            },
            "set"
          ],
          [
            "span",
            {
              "class": "token punctuation"
            },
            "("
          ],
          [
            "span",
            {
              "class": "token constant"
            },
            "PHOTO_STORAGE"
          ],
          [
            "span",
            {
              "class": "token punctuation"
            },
            ","
          ],
          " ",
          [
            "span",
            {
              "class": "token constant"
            },
            "JSON"
          ],
          [
            "span",
            {
              "class": "token punctuation"
            },
            "."
          ],
          [
            "span",
            {
              "class": "token function"
            },
            "stringify"
          ],
          [
            "span",
            {
              "class": "token punctuation"
            },
            "("
          ],
          "newPhotos",
          [
            "span",
            {
              "class": "token punctuation"
            },
            "."
          ],
          [
            "span",
            {
              "class": "token function"
            },
            "map"
          ],
          [
            "span",
            {
              "class": "token punctuation"
            },
            "("
          ],
          [
            "span",
            {
              "class": "token parameter"
            },
            "p"
          ],
          " ",
          [
            "span",
            {
              "class": "token operator"
            },
            "=>"
          ],
          " ",
          [
            "span",
            {
              "class": "token punctuation"
            },
            "{"
          ],
          "\n  ",
          [
            "span",
            {
              "class": "token comment"
            },
            "// Don't save the base64 representation of the photo data, "
          ],
          "\n  ",
          [
            "span",
            {
              "class": "token comment"
            },
            "// since it's already saved on the Filesystem"
          ],
          "\n  ",
          [
            "span",
            {
              "class": "token keyword"
            },
            "const"
          ],
          " photoCopy ",
          [
            "span",
            {
              "class": "token operator"
            },
            "="
          ],
          " ",
          [
            "span",
            {
              "class": "token punctuation"
            },
            "{"
          ],
          " ",
          [
            "span",
            {
              "class": "token operator"
            },
            "..."
          ],
          "p ",
          [
            "span",
            {
              "class": "token punctuation"
            },
            "}"
          ],
          [
            "span",
            {
              "class": "token punctuation"
            },
            ";"
          ],
          "\n  ",
          [
            "span",
            {
              "class": "token keyword"
            },
            "delete"
          ],
          " photoCopy",
          [
            "span",
            {
              "class": "token punctuation"
            },
            "."
          ],
          "base64",
          [
            "span",
            {
              "class": "token punctuation"
            },
            ";"
          ],
          "\n  ",
          [
            "span",
            {
              "class": "token keyword"
            },
            "return"
          ],
          " photoCopy",
          [
            "span",
            {
              "class": "token punctuation"
            },
            ";"
          ],
          "\n",
          [
            "span",
            {
              "class": "token punctuation"
            },
            "}"
          ],
          [
            "span",
            {
              "class": "token punctuation"
            },
            ")"
          ],
          [
            "span",
            {
              "class": "token punctuation"
            },
            ")"
          ],
          [
            "span",
            {
              "class": "token punctuation"
            },
            ")"
          ],
          [
            "span",
            {
              "class": "token punctuation"
            },
            ";"
          ]
        ]
      ],
      " "
    ],
    " ",
    [
      "p",
      null,
      "With the photo array data saved, we will create a method that will retrieve the data when the hook loads. We will do so by using React's ",
      [
        "code",
        null,
        "useEffect"
      ],
      " hook. Insert this above the ",
      [
        "code",
        null,
        "takePhoto"
      ],
      " declaration. Here is the code, and we will break it down:"
    ],
    " ",
    [
      "docs-code",
      {
        "language": "typescript"
      },
      " ",
      [
        "pre",
        null,
        [
          "code",
          null,
          [
            "span",
            {
              "class": "token function"
            },
            "useEffect"
          ],
          [
            "span",
            {
              "class": "token punctuation"
            },
            "("
          ],
          [
            "span",
            {
              "class": "token punctuation"
            },
            "("
          ],
          [
            "span",
            {
              "class": "token punctuation"
            },
            ")"
          ],
          " ",
          [
            "span",
            {
              "class": "token operator"
            },
            "=>"
          ],
          " ",
          [
            "span",
            {
              "class": "token punctuation"
            },
            "{"
          ],
          "\n  ",
          [
            "span",
            {
              "class": "token keyword"
            },
            "const"
          ],
          " ",
          [
            "span",
            {
              "class": "token function-variable function"
            },
            "loadSaved"
          ],
          " ",
          [
            "span",
            {
              "class": "token operator"
            },
            "="
          ],
          " ",
          [
            "span",
            {
              "class": "token keyword"
            },
            "async"
          ],
          " ",
          [
            "span",
            {
              "class": "token punctuation"
            },
            "("
          ],
          [
            "span",
            {
              "class": "token punctuation"
            },
            ")"
          ],
          " ",
          [
            "span",
            {
              "class": "token operator"
            },
            "=>"
          ],
          " ",
          [
            "span",
            {
              "class": "token punctuation"
            },
            "{"
          ],
          "\n    ",
          [
            "span",
            {
              "class": "token keyword"
            },
            "const"
          ],
          " photosString ",
          [
            "span",
            {
              "class": "token operator"
            },
            "="
          ],
          " ",
          [
            "span",
            {
              "class": "token keyword"
            },
            "await"
          ],
          " ",
          [
            "span",
            {
              "class": "token keyword"
            },
            "get"
          ],
          [
            "span",
            {
              "class": "token punctuation"
            },
            "("
          ],
          [
            "span",
            {
              "class": "token constant"
            },
            "PHOTO_STORAGE"
          ],
          [
            "span",
            {
              "class": "token punctuation"
            },
            ")"
          ],
          [
            "span",
            {
              "class": "token punctuation"
            },
            ";"
          ],
          "\n    ",
          [
            "span",
            {
              "class": "token keyword"
            },
            "const"
          ],
          " photos ",
          [
            "span",
            {
              "class": "token operator"
            },
            "="
          ],
          " ",
          [
            "span",
            {
              "class": "token punctuation"
            },
            "("
          ],
          "photosString ",
          [
            "span",
            {
              "class": "token operator"
            },
            "?"
          ],
          " ",
          [
            "span",
            {
              "class": "token constant"
            },
            "JSON"
          ],
          [
            "span",
            {
              "class": "token punctuation"
            },
            "."
          ],
          [
            "span",
            {
              "class": "token function"
            },
            "parse"
          ],
          [
            "span",
            {
              "class": "token punctuation"
            },
            "("
          ],
          "photosString",
          [
            "span",
            {
              "class": "token punctuation"
            },
            ")"
          ],
          " ",
          [
            "span",
            {
              "class": "token operator"
            },
            ":"
          ],
          " ",
          [
            "span",
            {
              "class": "token punctuation"
            },
            "["
          ],
          [
            "span",
            {
              "class": "token punctuation"
            },
            "]"
          ],
          [
            "span",
            {
              "class": "token punctuation"
            },
            ")"
          ],
          " ",
          [
            "span",
            {
              "class": "token keyword"
            },
            "as"
          ],
          " Photo",
          [
            "span",
            {
              "class": "token punctuation"
            },
            "["
          ],
          [
            "span",
            {
              "class": "token punctuation"
            },
            "]"
          ],
          [
            "span",
            {
              "class": "token punctuation"
            },
            ";"
          ],
          "\n    ",
          [
            "span",
            {
              "class": "token keyword"
            },
            "for"
          ],
          " ",
          [
            "span",
            {
              "class": "token punctuation"
            },
            "("
          ],
          [
            "span",
            {
              "class": "token keyword"
            },
            "let"
          ],
          " photo ",
          [
            "span",
            {
              "class": "token keyword"
            },
            "of"
          ],
          " photos",
          [
            "span",
            {
              "class": "token punctuation"
            },
            ")"
          ],
          " ",
          [
            "span",
            {
              "class": "token punctuation"
            },
            "{"
          ],
          "\n      ",
          [
            "span",
            {
              "class": "token keyword"
            },
            "const"
          ],
          " file ",
          [
            "span",
            {
              "class": "token operator"
            },
            "="
          ],
          " ",
          [
            "span",
            {
              "class": "token keyword"
            },
            "await"
          ],
          " ",
          [
            "span",
            {
              "class": "token function"
            },
            "readFile"
          ],
          [
            "span",
            {
              "class": "token punctuation"
            },
            "("
          ],
          [
            "span",
            {
              "class": "token punctuation"
            },
            "{"
          ],
          "\n        path",
          [
            "span",
            {
              "class": "token operator"
            },
            ":"
          ],
          " photo",
          [
            "span",
            {
              "class": "token punctuation"
            },
            "."
          ],
          "filepath",
          [
            "span",
            {
              "class": "token punctuation"
            },
            ","
          ],
          "\n        directory",
          [
            "span",
            {
              "class": "token operator"
            },
            ":"
          ],
          " FilesystemDirectory",
          [
            "span",
            {
              "class": "token punctuation"
            },
            "."
          ],
          "Data\n      ",
          [
            "span",
            {
              "class": "token punctuation"
            },
            "}"
          ],
          [
            "span",
            {
              "class": "token punctuation"
            },
            ")"
          ],
          [
            "span",
            {
              "class": "token punctuation"
            },
            ";"
          ],
          "\n      photo",
          [
            "span",
            {
              "class": "token punctuation"
            },
            "."
          ],
          "base64 ",
          [
            "span",
            {
              "class": "token operator"
            },
            "="
          ],
          " ",
          [
            "span",
            {
              "class": "token template-string"
            },
            [
              "span",
              {
                "class": "token template-punctuation string"
              },
              "`"
            ],
            [
              "span",
              {
                "class": "token string"
              },
              "data:image/jpeg;base64,"
            ],
            [
              "span",
              {
                "class": "token interpolation"
              },
              [
                "span",
                {
                  "class": "token interpolation-punctuation punctuation"
                },
                "${"
              ],
              "file",
              [
                "span",
                {
                  "class": "token punctuation"
                },
                "."
              ],
              "data",
              [
                "span",
                {
                  "class": "token interpolation-punctuation punctuation"
                },
                "}"
              ]
            ],
            [
              "span",
              {
                "class": "token template-punctuation string"
              },
              "`"
            ]
          ],
          [
            "span",
            {
              "class": "token punctuation"
            },
            ";"
          ],
          "\n    ",
          [
            "span",
            {
              "class": "token punctuation"
            },
            "}"
          ],
          "\n    ",
          [
            "span",
            {
              "class": "token function"
            },
            "setPhotos"
          ],
          [
            "span",
            {
              "class": "token punctuation"
            },
            "("
          ],
          "photos",
          [
            "span",
            {
              "class": "token punctuation"
            },
            ")"
          ],
          [
            "span",
            {
              "class": "token punctuation"
            },
            ";"
          ],
          "\n  ",
          [
            "span",
            {
              "class": "token punctuation"
            },
            "}"
          ],
          [
            "span",
            {
              "class": "token punctuation"
            },
            ";"
          ],
          "\n  ",
          [
            "span",
            {
              "class": "token function"
            },
            "loadSaved"
          ],
          [
            "span",
            {
              "class": "token punctuation"
            },
            "("
          ],
          [
            "span",
            {
              "class": "token punctuation"
            },
            ")"
          ],
          [
            "span",
            {
              "class": "token punctuation"
            },
            ";"
          ],
          "\n",
          [
            "span",
            {
              "class": "token punctuation"
            },
            "}"
          ],
          [
            "span",
            {
              "class": "token punctuation"
            },
            ","
          ],
          " ",
          [
            "span",
            {
              "class": "token punctuation"
            },
            "["
          ],
          [
            "span",
            {
              "class": "token keyword"
            },
            "get"
          ],
          [
            "span",
            {
              "class": "token punctuation"
            },
            ","
          ],
          " readFile",
          [
            "span",
            {
              "class": "token punctuation"
            },
            "]"
          ],
          [
            "span",
            {
              "class": "token punctuation"
            },
            ")"
          ],
          [
            "span",
            {
              "class": "token punctuation"
            },
            ";"
          ]
        ]
      ],
      " "
    ],
    " ",
    [
      "p",
      null,
      "This seems a bit scary at first, so let's walk through it, first by looking at the second parameter we pass into the hook: the dependency array ",
      [
        "code",
        null,
        "[get, readFile]"
      ],
      ". "
    ],
    " ",
    [
      "p",
      null,
      "The useEffect hook, by default, gets called each time a component renders, unless, we pass in a dependency array. In that case, it will only run when a dependency gets updated. In our case we only want it to be called once. The ",
      [
        "code",
        null,
        "get"
      ],
      " and ",
      [
        "code",
        null,
        "readFile"
      ],
      " methods will never change so the callback will only be run once. "
    ],
    " ",
    [
      "p",
      null,
      "The dependency array should pass in any external references the hook will use internally, which is why we pass in the ",
      [
        "code",
        null,
        "get"
      ],
      " and ",
      [
        "code",
        null,
        "readFile"
      ],
      " methods."
    ],
    " ",
    [
      "p",
      null,
      "The first parameter to ",
      [
        "code",
        null,
        "useEffect"
      ],
      " is the function that will be called by the effect. We pass in an anonymous arrow function, and inside of it we define another asynchronous method and then immediately call this. We have to call the async function from within the hook as the hook callback can't be asynchronous itself."
    ],
    " ",
    [
      "p",
      null,
      "On mobile (coming up next!), we can directly set the source of an image tag - ",
      [
        "code",
        null,
        "<img src=”x” />"
      ],
      " - to each photo file on the Filesystem, displaying them automatically. On the web, however, we must read each image from the Filesystem into base64 format, using a new ",
      [
        "code",
        null,
        "base64"
      ],
      " property on the ",
      [
        "code",
        null,
        "Photo"
      ],
      " object. This is because the Filesystem API uses ",
      [
        "a",
        {
          "href": "https://developer.mozilla.org/en-US/docs/Web/API/IndexedDB_API"
        },
        "IndexedDB"
      ],
      " under the hood. "
    ],
    " ",
    [
      "p",
      null,
      "Since are photos are either displayed with base64 encoded content, or a file path, we need to update the IonImg's src prop (in the Tab2 component) to pass in base64 if it is available, or fallback to the webviewPath if not:"
    ],
    " ",
    [
      "docs-code",
      {
        "language": "typescript"
      },
      " ",
      [
        "pre",
        null,
        [
          "code",
          null,
          [
            "span",
            {
              "class": "token operator"
            },
            "<"
          ],
          "IonImg src",
          [
            "span",
            {
              "class": "token operator"
            },
            "="
          ],
          [
            "span",
            {
              "class": "token punctuation"
            },
            "{"
          ],
          "photo",
          [
            "span",
            {
              "class": "token punctuation"
            },
            "."
          ],
          "base64 ",
          [
            "span",
            {
              "class": "token operator"
            },
            "??"
          ],
          " photo",
          [
            "span",
            {
              "class": "token punctuation"
            },
            "."
          ],
          "webviewPath",
          [
            "span",
            {
              "class": "token punctuation"
            },
            "}"
          ],
          " ",
          [
            "span",
            {
              "class": "token operator"
            },
            "/"
          ],
          [
            "span",
            {
              "class": "token operator"
            },
            ">"
          ]
        ]
      ],
      " "
    ],
    " ",
    [
      "blockquote",
      null,
      " ",
      [
        "p",
        null,
        "The ",
        [
          "code",
          null,
          "??"
        ],
        " is the new JavaScript null coalescing operator. It will return the first operand if it is not null or undefined, otherwise it will return the second operand."
      ],
      " "
    ],
    " ",
    [
      "p",
      null,
      "That’s it! We’ve built a complete Photo Gallery feature in our Ionic app that works on the web. Next up, we’ll transform it into a mobile app for iOS and Android!"
    ]
  ],
  "title": "Loading Photos from the Filesystem",
  "headings": [
    {
      "text": "Storage API",
      "href": "#storage-api"
    }
  ],
  "pageClass": "page-react-your-first-app-4-loading-photos"
}
